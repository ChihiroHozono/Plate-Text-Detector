# アプリの想定フロー

1. 画像の前処理

2. OCR

3. OCR結果をS3に保存

   

## 1. 前処理
### 前処理の目的

OCRの精度向上



### 前処理のフロー

1. 写真から植物プレートをトリミング
   1. プレート以外をマスク
   2. 輪郭検出 or エッジ検出
   3. 直線検出
2. 台形補正



### 前処理関連メモ

#### 1. 写真から植物プレートをトリミング

1. プレート以外をマスク

   - エッジ検出するにしても、前処理で不要な箇所はマスクしたい

   - 方法

     - 色

       - 方法
         - RGB
           - RGBに一定の閾値を設けて、マスク
             - ⇨プレートだけ、目立つようにはできなかった。
           - Greenにだけ一定の閾値を設けて、マスク
             - ⇨プレートだけ、目立つようにはできなかった。
           - RGBの各値のレンジを設け、マスク
             - ⇨割と良い感じにマスクできている。
         - HSVでも良いかも
           - かなり良い感じ
           - 現在は、Hだけで条件絞っているが、S・Vも絞るとさらに良いかも

     - 二値化

       - 適応的閾値処理で二値化
         - 適応している事が仇となり、今回だと求めている結果にならない。
       - 大津の二値化

       

2. 輪郭検出

   - 方法
     - OpenCVのfindContours
   - その他
     - 輪郭の近似

2. エッジ検出
   - 方法
     - ソーベル法
     - ラプラシアン法
     - キャニー法
   - メモ
     - エッジ検出後にモルフォロジー処理（形態演算）
   - 参考
     - https://jp.mathworks.com/discovery/edge-detection.html
     - https://code-graffiti.com/opencv-morphological-operators-in-python/

3. 直線検出
   - 方法
     - ハフ変換
       - パラメータ空間に変換
       - https://jp.mathworks.com/discovery/image-transform.html
     - 確率的ハフ変換
     - LSD
   - 前処理
     - ブラー
     - 二値化

3. 領域検出
   - 流れ
     - 特徴量抽出・特徴空間生成
       - 閾値は識別関数表現の1つ
     - 画像空間への反映
   - 方法
     - 教師なし
       -  領域の輝度値や抽出したい形状に関するエネルギー(目的関 数)を最小化・最大化する事で特徴量の分布や滑らかさを基準
       -  方法
          - 大津の二値化法
            - 二値化だけでは、領域抽出が難しそう
          - Snake (Active Contour)（動的輪郭モデル）
          - Graph Cuts
          - Mean Shift
          - Water Shed (Region Growing)
          - モデルを用いた検出
            - エッジ抽出、コーナー抽出、テンプレートマッチング、線・円・形状抽出
     - 教師あり

- 輪郭の近似でうまくいった。

### 2. 台形補正

- 方法
  - 透視変換の行列
  - 変換行列を用いた、画像の透視変換



#### Others

- 幾何変換・射影変換
- ノイズ除去に、オープニングをやってみたが微妙だった
- コーナー検出

- Idea
  - 文字領域を抽出し、最左上、右上、左下、右下を探し出し、トリミング
    - これだと台形補正ができなそう
  - 文字領域抽出
     - MSER

- - 帳票分類

- 参考資料
  - http://agora.ex.nii.ac.jp/~kitamoto/research/publications/k:tric06y.pdf
  - http://www2.riken.jp/brict/Yoshizawa/Lectures/IP2011/Lec24.pdf

  

## Others Note

### アプリ機能のidea

- 植物の名前検出



### プレートの色情報

20200412_1

- RGB（0x）
  - 165c51
- BGR
  -  22,92,81